input: |
  tag: user.code_functions
  -
  # Default implementation of capture listens for the following keywords in any
  # order: private pro pub static
  #
  # The default action implementation looks for the token combination on the left
  # (funky is added here for searchability) and calls the function on the right:
  #
  #   * funky -> code_default_function
  #   * private funky -> code_private_function
  #   * pro funky -> code_protected_function
  #   * pub funky -> code_public_function
  #   * static funky -> code_private_static_function
  #   * private static funky -> code_private_static_function
  #   * pro static funky -> code_protected_static_function
  #   * pub static funky -> code_public_static_function
  #
  ^{user.code_function_modifier}* funky <user.text>$:
    user.code_modified_function(code_function_modifier_list or 0, text)

  # for annotating function parameters
  is type <user.code_type>: user.code_insert_type_annotation(code_type)
  returns [type] <user.code_type>: user.code_insert_return_type(code_type)

  # for generic reference of types
  type <user.code_type>: insert(code_type)
output:
  children:
  - children:
    - children:
      - text: tag
        type: identifier
      - text: ' user.code_functions'
        type: implicit_string
      key:
        text: tag
        type: identifier
      pattern:
        text: ' user.code_functions'
        type: implicit_string
      type: match
    type: context
  - text: '# Default implementation of capture listens for the following keywords
      in any'
    type: comment
  - text: '# order: private pro pub static'
    type: comment
  - text: '#'
    type: comment
  - text: '# The default action implementation looks for the token combination on
      the left'
    type: comment
  - text: '# (funky is added here for searchability) and calls the function on the
      right:'
    type: comment
  - text: '#'
    type: comment
  - text: '#   * funky -> code_default_function'
    type: comment
  - text: '#   * private funky -> code_private_function'
    type: comment
  - text: '#   * pro funky -> code_protected_function'
    type: comment
  - text: '#   * pub funky -> code_public_function'
    type: comment
  - text: '#   * static funky -> code_private_static_function'
    type: comment
  - text: '#   * private static funky -> code_private_static_function'
    type: comment
  - text: '#   * pro static funky -> code_protected_static_function'
    type: comment
  - text: '#   * pub static funky -> code_public_static_function'
    type: comment
  - text: '#'
    type: comment
  - children:
    - children:
      - text: ^
        type: start_anchor
      - children:
        - children:
          - children:
            - text: user.code_function_modifier
              type: identifier
            list_name:
              text: user.code_function_modifier
              type: identifier
            type: list
          type: repeat
        - text: funky
          type: word
        - capture_name:
            text: user.text
            type: identifier
          children:
          - text: user.text
            type: identifier
          type: capture
        type: seq
      - text: $
        type: end_anchor
      type: rule
    - children:
      - children:
        - action_name:
            text: user.code_modified_function
            type: identifier
          arguments:
            children:
            - children:
              - children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              - text: or
                type: operator
              - text: '0'
                type: integer
              left:
                children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              operator:
                text: or
                type: operator
              right:
                text: '0'
                type: integer
              type: binary_operator
            - children:
              - text: text
                type: identifier
              type: variable
              variable_name:
                text: text
                type: identifier
            type: argument_list
          children:
          - text: user.code_modified_function
            type: identifier
          - children:
            - children:
              - children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              - text: or
                type: operator
              - text: '0'
                type: integer
              left:
                children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              operator:
                text: or
                type: operator
              right:
                text: '0'
                type: integer
              type: binary_operator
            - children:
              - text: text
                type: identifier
              type: variable
              variable_name:
                text: text
                type: identifier
            type: argument_list
          type: action
        expression:
          action_name:
            text: user.code_modified_function
            type: identifier
          arguments:
            children:
            - children:
              - children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              - text: or
                type: operator
              - text: '0'
                type: integer
              left:
                children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              operator:
                text: or
                type: operator
              right:
                text: '0'
                type: integer
              type: binary_operator
            - children:
              - text: text
                type: identifier
              type: variable
              variable_name:
                text: text
                type: identifier
            type: argument_list
          children:
          - text: user.code_modified_function
            type: identifier
          - children:
            - children:
              - children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              - text: or
                type: operator
              - text: '0'
                type: integer
              left:
                children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              operator:
                text: or
                type: operator
              right:
                text: '0'
                type: integer
              type: binary_operator
            - children:
              - text: text
                type: identifier
              type: variable
              variable_name:
                text: text
                type: identifier
            type: argument_list
          type: action
        type: expression
      type: block
    rule:
      children:
      - text: ^
        type: start_anchor
      - children:
        - children:
          - children:
            - text: user.code_function_modifier
              type: identifier
            list_name:
              text: user.code_function_modifier
              type: identifier
            type: list
          type: repeat
        - text: funky
          type: word
        - capture_name:
            text: user.text
            type: identifier
          children:
          - text: user.text
            type: identifier
          type: capture
        type: seq
      - text: $
        type: end_anchor
      type: rule
    script:
      children:
      - children:
        - action_name:
            text: user.code_modified_function
            type: identifier
          arguments:
            children:
            - children:
              - children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              - text: or
                type: operator
              - text: '0'
                type: integer
              left:
                children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              operator:
                text: or
                type: operator
              right:
                text: '0'
                type: integer
              type: binary_operator
            - children:
              - text: text
                type: identifier
              type: variable
              variable_name:
                text: text
                type: identifier
            type: argument_list
          children:
          - text: user.code_modified_function
            type: identifier
          - children:
            - children:
              - children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              - text: or
                type: operator
              - text: '0'
                type: integer
              left:
                children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              operator:
                text: or
                type: operator
              right:
                text: '0'
                type: integer
              type: binary_operator
            - children:
              - text: text
                type: identifier
              type: variable
              variable_name:
                text: text
                type: identifier
            type: argument_list
          type: action
        expression:
          action_name:
            text: user.code_modified_function
            type: identifier
          arguments:
            children:
            - children:
              - children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              - text: or
                type: operator
              - text: '0'
                type: integer
              left:
                children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              operator:
                text: or
                type: operator
              right:
                text: '0'
                type: integer
              type: binary_operator
            - children:
              - text: text
                type: identifier
              type: variable
              variable_name:
                text: text
                type: identifier
            type: argument_list
          children:
          - text: user.code_modified_function
            type: identifier
          - children:
            - children:
              - children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              - text: or
                type: operator
              - text: '0'
                type: integer
              left:
                children:
                - text: code_function_modifier_list
                  type: identifier
                type: variable
                variable_name:
                  text: code_function_modifier_list
                  type: identifier
              operator:
                text: or
                type: operator
              right:
                text: '0'
                type: integer
              type: binary_operator
            - children:
              - text: text
                type: identifier
              type: variable
              variable_name:
                text: text
                type: identifier
            type: argument_list
          type: action
        type: expression
      type: block
    type: command
  - text: '# for annotating function parameters'
    type: comment
  - children:
    - children:
      - children:
        - text: is
          type: word
        - text: type
          type: word
        - capture_name:
            text: user.code_type
            type: identifier
          children:
          - text: user.code_type
            type: identifier
          type: capture
        type: seq
      type: rule
    - children:
      - children:
        - action_name:
            text: user.code_insert_type_annotation
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: user.code_insert_type_annotation
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        expression:
          action_name:
            text: user.code_insert_type_annotation
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: user.code_insert_type_annotation
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        type: expression
      type: block
    rule:
      children:
      - children:
        - text: is
          type: word
        - text: type
          type: word
        - capture_name:
            text: user.code_type
            type: identifier
          children:
          - text: user.code_type
            type: identifier
          type: capture
        type: seq
      type: rule
    script:
      children:
      - children:
        - action_name:
            text: user.code_insert_type_annotation
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: user.code_insert_type_annotation
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        expression:
          action_name:
            text: user.code_insert_type_annotation
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: user.code_insert_type_annotation
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        type: expression
      type: block
    type: command
  - children:
    - children:
      - children:
        - text: returns
          type: word
        - children:
          - text: type
            type: word
          type: optional
        - capture_name:
            text: user.code_type
            type: identifier
          children:
          - text: user.code_type
            type: identifier
          type: capture
        type: seq
      type: rule
    - children:
      - children:
        - action_name:
            text: user.code_insert_return_type
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: user.code_insert_return_type
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        expression:
          action_name:
            text: user.code_insert_return_type
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: user.code_insert_return_type
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        type: expression
      type: block
    rule:
      children:
      - children:
        - text: returns
          type: word
        - children:
          - text: type
            type: word
          type: optional
        - capture_name:
            text: user.code_type
            type: identifier
          children:
          - text: user.code_type
            type: identifier
          type: capture
        type: seq
      type: rule
    script:
      children:
      - children:
        - action_name:
            text: user.code_insert_return_type
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: user.code_insert_return_type
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        expression:
          action_name:
            text: user.code_insert_return_type
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: user.code_insert_return_type
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        type: expression
      type: block
    type: command
  - text: '# for generic reference of types'
    type: comment
  - children:
    - children:
      - children:
        - text: type
          type: word
        - capture_name:
            text: user.code_type
            type: identifier
          children:
          - text: user.code_type
            type: identifier
          type: capture
        type: seq
      type: rule
    - children:
      - children:
        - action_name:
            text: insert
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: insert
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        expression:
          action_name:
            text: insert
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: insert
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        type: expression
      type: block
    rule:
      children:
      - children:
        - text: type
          type: word
        - capture_name:
            text: user.code_type
            type: identifier
          children:
          - text: user.code_type
            type: identifier
          type: capture
        type: seq
      type: rule
    script:
      children:
      - children:
        - action_name:
            text: insert
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: insert
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        expression:
          action_name:
            text: insert
            type: identifier
          arguments:
            children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          children:
          - text: insert
            type: identifier
          - children:
            - children:
              - text: code_type
                type: identifier
              type: variable
              variable_name:
                text: code_type
                type: identifier
            type: argument_list
          type: action
        type: expression
      type: block
    type: command
  type: source_file
